/*! angular-csv-import - v0.0.15 - 2015-04-08
* Copyright (c) 2015 ; Licensed  */
"use strict";var csvImport=angular.module("ngCsvImport",[]);csvImport.directive("ngCsvImport",function(){return{restrict:"E",transclude:!0,replace:!0,scope:{content:"=",header:"=",headerVisible:"=",separator:"=",error:"=",result:"="},template:'<div><input id="uploadFile" placeholder="Choose File" disabled="disabled" /><div class="fileUpload btn btn-primary btn-sm"><span>Import</span><input id="theFile" class="upload" accept=".csv" type="file"/></div></div>',link:function(e,r){r.on("keyup",function(r){if(null!=e.content){var a={csv:e.content,header:e.header,separator:r.target.value};e.result=t(a),e.$apply()}}),r.on("change",function(r){var a=document.getElementById("theFile").value;if(e.error=null,a){var l=a.split(".").pop().toLowerCase();"csv"!=l&&(e.error="Only csv files allowed")}document.getElementById("uploadFile").value=a;var n=new FileReader;if(n.onload=function(r){e.$apply(function(){var a={csv:r.target.result.replace(/\r\n|\r/g,"\n"),header:e.header,separator:e.separator,error:e.error};e.content=a.csv,e.result=t(a)})},"file"!==r.target.type||null==r.target.files&&null==r.srcElement.files){if(null!=e.content){var s={csv:e.content,header:!e.header,separator:e.separator};e.result=t(s)}}else n.readAsText((r.srcElement||r.target).files[0])});var t=function(e){var r=[];if(e.error)return r;var t=e.csv.split("\n"),a=0,l=t[0].split(e.separator).length,n=[];e.header===!0?(n=t[0].split(e.separator),a=1):e.header&&(n=e.header.split(e.separator),a=1);for(var s=a;s<t.length;s++){var o={},i=t[s].split(new RegExp(e.separator+'(?![^"]*"(?:(?:[^"]*"){2})*[^"]*$)'));if(i.length===l){if(e.header)for(var p=0;p<n.length;p++)o[n[p]]=i[p];else for(var c=0;c<i.length;c++)o[c]=i[c];r.push(o)}}return r}}}});